"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function send_ajax_request(e,t,n,a,r){var o=new XMLHttpRequest;o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&r(200===o.status?o.responseText:null)},o.open(t,e,a),o.setRequestHeader("Content-Type","application/json"),o.send(n)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),LOGIN=0,REGISTER=1,RESET_PW=2,ControlledInput=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={value:e.initialValue||""},n.handleChange=n.handleChange.bind(n),n}return _inherits(t,React.Component),_createClass(t,[{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"render",value:function(){return React.createElement("input",{value:this.state.value,onChange:this.handleChange,type:this.props.type,placeholder:this.props.placeholder,className:this.props.className,autoComplete:this.props.autoComplete})}}]),t}(),Login=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={form_state:LOGIN},e}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return this.state.form_state==LOGIN?this.login():this.state.form_state==REGISTER?this.register():this.state.form_state==RESET_PW?this.reset_pw():void 0}},{key:"login",value:function(){var e=this;return React.createElement("div",{className:"login"},React.createElement(ControlledInput,{autoComplete:"on",type:"text",placeholder:"Username",className:"form-element"}),React.createElement(ControlledInput,{autoComplete:"new-password",type:"password",placeholder:"Password",className:"form-element"}),React.createElement("div",{className:"form-col-2 form-element"},React.createElement("button",{className:"form-element",onClick:function(){return e.setState({form_state:REGISTER})}},"Register"),React.createElement("button",{className:"form-element"},"Login")))}},{key:"register",value:function(){return React.createElement("div",{className:"login"},React.createElement(ControlledInput,{autoComplete:"on",type:"text",placeholder:"Username *",className:"form-element"}),React.createElement(ControlledInput,{autoComplete:"new-password",type:"password",placeholder:"Password *",className:"form-element"}),React.createElement(ControlledInput,{autoComplete:"on",type:"email",placeholder:"E-Mail *",className:"form-element"}),React.createElement("div",{className:"form-col-2 form-element"},React.createElement("button",{className:"form-element"},"Register")))}}]),t}(),Route=ReactRouterDOM.Route,Link=ReactRouterDOM.Link,Header=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this;return React.createElement("div",{className:"header"},React.createElement("div",{className:"clear-btn btn",onClick:function(e){window.dispatchEvent(new Event("app.editor.clear"))}},React.createElement("img",{className:"icon",src:"public/images/clear.svg",alt:"clear"}),React.createElement("p",null,"New")),React.createElement("div",{className:"save-btn btn",onClick:function(e){window.dispatchEvent(new Event("app.editor.save"))}},React.createElement("img",{className:"icon",src:"public/images/save.svg",alt:"save"}),React.createElement("p",null,"Save")),React.createElement("div",{className:"login-btn btn",onClick:function(){e.onLoginClicked()}},React.createElement("p",null,rustbin.app.state.user||"Not signed in"),React.createElement("img",{className:"icon",src:"public/images/arrow.svg",alt:"expand-menu"})))}},{key:"onLoginClicked",value:function(){rustbin.app.state.user?rustbin.app.toggleMenu():rustbin.app.toggleLogin()}}]),t}(),Editor=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));console.log(location.pathname);var n=e;return n.code="",location.pathname&&"/"!=location.pathname&&send_ajax_request("./api/get/"+location.pathname,"GET",null,!1,function(e){n.code=e,setTimeout(function(){document.querySelector(".editor textarea").value=e},100),c}),window.addEventListener("app.editor.clear",function(){document.querySelector(".editor textarea").value=""}),window.addEventListener("app.editor.save",function(){var e=document.querySelector(".editor textarea").value;send_ajax_request("./api/save","POST",JSON.stringify({payload:e}),!0,function(e){if(null!==e){var t=JSON.parse(e);location.pathname=String(t.id)}else console.error("API Request to './api/save' has failed")})}),window.addEventListener("keydown",function(e){if(e.ctrlKey||e.metaKey)switch(String.fromCharCode(event.which).toLowerCase()){case"s":e.preventDefault(),window.dispatchEvent(new Event("app.editor.save"))}}),e}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"editor"},React.createElement("textarea",{spellCheck:"false"}))}}]),t}(),Application=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return window.rustbin=window.rustbin||{},window.rustbin.app=e,e.state={user:null,loginExpanded:!1},e}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("div",null,React.createElement(Header,null),this.state.loginExpanded&&React.createElement(Login,null),React.createElement("div",{className:"main"},React.createElement(Editor,null)))}},{key:"toggleLogin",value:function(){this.setState({loginExpanded:!this.state.loginExpanded})}}]),t}();ReactDOM.render(React.createElement(Application,null),document.getElementById("react-container"));for(var textareas=document.getElementsByTagName("textarea"),count=textareas.length,i=0;i<count;i++)textareas[i].onkeydown=function(e){if(9==e.keyCode||9==e.which){e.preventDefault();var t=this.selectionStart;this.value=this.value.substring(0,this.selectionStart)+"\t"+this.value.substring(this.selectionEnd),this.selectionEnd=t+1}};